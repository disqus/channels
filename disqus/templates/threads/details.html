{% extends "layout.html" %}

{% block subheader %}
  <h2>{{ thread.title }}</h2>
{% endblock %}

{% block head %}
<script type="text/javascript" src="{{ url_for('static', filename='js/jquery.autoresize.js') }}"></script>
<script type="text/javascript">
    var threadId = "{{ thread.id }}";
    var initialPosts = {{ post_list|as_json }};
    var current_user = {{ current_user|as_json }};
    var initialParticipants = {{ participant_list|as_json }};
    var channels = {{ channel_list|as_json }};
    var realtime_host = "{{ realtime_host }}";
</script>
{% endblock %}

{% block foot %}
<script type="text/javascript" src="{{ url_for('static', filename='js/thread_details.js') }}"></script>
{% endblock %}

{% block sidebar %}
  <div class="page-header">
    <h4>Participants</h4>
  </div>
  <ul id="participant-ul" class="user-list">
  </ul>
  <div class="page-header">
    <h4>Active Participants</h4>
  </div>
  <ul id="active-ul" class="user-list">
  </ul>
  {% if active_talk_list %}
    <div class="page-header">
      <h4>Sessions</h4>
    </div>
    <ul class="thread-list">
      {% for thread in active_talk_list %}
        {% include "includes/thread.html" %}
      {% endfor %}
    </ul>
  {% endif %}
  <div class="page-header">
    <h4>Active Conversations</h4>
  </div>
  <ul class="thread-list">
    {% for thread in active_thread_list %}
      {% include "includes/thread.html" %}
    {% endfor %}
  </ul>
  {% if my_thread_list %}
    <div class="page-header">
      <h4>Your Conversations</h4>
    </div>
    <ul class="thread-list">
      {% for thread in my_thread_list %}
        {% include "includes/thread.html" %}
      {% endfor %}
    </ul>
  {% endif %}
{% endblock %}

{% block content %}
  {% if pycon_session %}
    <div class="row-fluid">
      <div class="span9 topic collapsed">
        <div class="topic-inner">
          <div class="author">
            <h4><a href="#"><strong>{{ pycon_session.authors }}</strong></a></h4>
            <a class="link" href="{{ pycon_session.url }}">pycon.org</a>
          </div>
          <div class="date">
            {{ pycon_session.start|format_datetime(pycon_session.end) }}
            in {{ pycon_session.room }}
          </div>

          <div class="description">
            <p>{{ pycon_session.description }}</p>
          </div>
        </div>
      </div>
    </div>
  {% endif %}

  <script id="post-template" type="text/template">
    <img src="<%= avatar %>" class="post-avatar">
    <div class="post-meta">
      <span class="post-author">
        <%= name %>
      </span>
      &middot;
      <span class="post-datetime pretty-date" title="<%= createdAtISO %>Z">
        <%= createdAtSince %>
      </span>
        <div class="post-resend" style="display: none;">
          <button class="btn btn-warning" data-loading-text="Resending">Resend</button>
        </div>
    </div>
    <div class="post-message">
      <%= message %>
    </div>
  </script>

  <script id="participant-template" type="text/template">
      <a href="<%= profileLink %>">
          <img rel="tooltip" src="<%= avatar %>" title="<%= name %>">
      </a>
  </script>

  <div class="conversation{% if pycon_session %} has-topic{% endif %}">
    <ul class="post-list">
    </ul>
  {#    <p>It seems no one is participating in this conversation yet.</p>#}
</div>

<div class="row-fluid">
  <div class="new-reply span9">
    {% if not user %}
      <p>You are not signed in. You can <strong><a href="{{ url_for('oauth_authorize') }}">sign in with Disqus</a></strong>. Need to create an
        account first? <strong><a href="http://disqus.com/profile/signup/">Register a new account</a></strong> on
        disqus.com.</p>
    {% else %}
      <form method="POST" id="replyform" class="form-stack" action="{{ url_for('new_post', thread_id=thread.id) }}">
        <fieldset>
            {{ form.message(rows=2) }}
            <button type="submit" class="btn btn-large btn-primary">Send Reply</button>
        </fieldset>
      </form>
    {% endif %}
  </div>
</div>
{% endblock %}
