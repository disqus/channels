var http = require('http')
  , fs = require('fs')
  , path = require('path')
  , streams = require('./main')
  ;


http.createServer(function (req, resp) {
  console.log(req.method, req.url)
  if (req.url === '/favicon.ico') {
    resp.writeHead(404)
    resp.end();
    return;
  }
  
  var f = fs.createReadStream(path.join(__dirname, 'main.js'))
    , u = new streams.UpgradableStream()
    ;
  
  resp.writeHead(200, {'content-type':'text/plain'})
  f.pipe(u)
  u.pipe(resp)
}).listen(8000)

